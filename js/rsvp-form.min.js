var current_fs,next_fs,previous_fs,left,opacity,scale,animating;const RSVP_GET_PARTY_API_ENDPOINT="https://ju331w77pk.execute-api.us-east-1.amazonaws.com/production/rsvp/parties/30d6c915-79fa-44e3-9688-bd441b42bea0";$(".next").click((function(){$("#alert-wrapper").html(alert_markup("info","<strong>Just a sec!</strong> We are looking for your invite.")),getPartyByInviteCode($("#invite_code").val()).then((e=>{showRSVPForm($(this)),setTimeout((()=>{$("#alert-wrapper").html("")}),1e3),prefillRSVP(e)})).catch((e=>{$("#alert-wrapper").html(alert_markup("danger","<strong>Sorry!</strong> There is some issue with the server. ")),console.log(e)}))})),$(".previous").click((function(){if(animating)return!1;animating=!0,current_fs=$(this).parent(),previous_fs=$(this).parent().prev(),$("#progressbar li").eq($("fieldset").index(current_fs)).removeClass("active"),previous_fs.show(),current_fs.animate({opacity:0},{step:function(e,t){scale=.8+.2*(1-e),left=50*(1-e)+"%",opacity=1-e,current_fs.css({left:left}),previous_fs.css({transform:"scale("+scale+")",opacity:opacity})},duration:800,complete:function(){animating=!1},easing:"easeInOutBack"})}));var urlParams=new URLSearchParams(window.location.search),inviteCode=urlParams.get("inviteCode");function transformForUpdate(e){delete e.rsvp_form_guest_name,delete e.rsvp_guest_id;var t=Object.entries(e).filter((([e,t])=>e.startsWith("rsvp_guest_id"))),s=Object.entries(e).filter((([e,t])=>e.startsWith("rsvp_form_guest_name"))),r=Object.entries(e).filter((([e,t])=>e.startsWith("rsvp_status"))),a={inviteCode:e.invite_code,guests:[]};for(let e=0;e<s.length;e++)a.guests.push({id:t[e][1],name:s[e][1],rsvpStatus:r[e][1]});return a}function getPartyByInviteCode(e){return fetch(RSVP_GET_PARTY_API_ENDPOINT,{headers:{"x-api-key":"j6dXUMr5I66iANmJFL5Iqm8TCh1xhsC3ayRsoyui"}}).then((e=>e.json()))}function updateRSVP(e){return fetch(RSVP_GET_PARTY_API_ENDPOINT,{method:"PATCH",body:JSON.stringify(e),headers:{"Content-type":"application/json; charset=UTF-8","x-api-key":"j6dXUMr5I66iANmJFL5Iqm8TCh1xhsC3ayRsoyui"}})}function prefillRSVP(e){$("#plus_one_container").html(""),e.guests.forEach((e=>{$("<div/>",{class:"plus_one row",html:plusOneTemplateHTML()}).hide().appendTo("#plus_one_container").slideDown("slow")})),e.guests.forEach(((e,t)=>{var s=e.firstName+" "+e.lastName;$(`[name=rsvp_form_guest_name${t}]`).val(s).trigger("change")})),e.guests.forEach(((e,t)=>{"ATTENDING"===e.rsvpStatus?$(`input:radio[name=rsvp_status${t}][value=ATTENDING]`).click():$(`input:radio[name=rsvp_status${t}][value=DECLINED]`).click()})),e.guests.forEach(((e,t)=>{var s=e.id;$(`[name=rsvp_guest_id${t}]`).val(s).trigger("change")}))}function plusOneTemplateHTML(){var e=$(".plus_one").length,t=$(".plus_one_template").clone();t.find("[name=rsvp_guest_id]")[0].name="rsvp_guest_id"+e,t.find("[name=rsvp_form_guest_name]")[0].name="rsvp_form_guest_name"+e;var s=t.find("[name=rsvp_status]");return s[0].name="rsvp_status"+e,s[0].id=`rsvp-status-accept${e}`,s[1].name="rsvp_status"+e,s[1].id=`rsvp-status-decline${e}`,t.html()}function showRSVPForm(e){if(animating)return!1;animating=!0,current_fs=e.parent(),next_fs=e.parent().next(),$("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active"),next_fs.show(),current_fs.animate({opacity:0},{step:function(e,t){scale=1-.2*(1-e),left=50*e+"%",opacity=1-e,current_fs.css({transform:"scale("+scale+")",position:"absolute"}),next_fs.css({left:left,opacity:opacity})},duration:800,complete:function(){current_fs.hide(),animating=!1},easing:"easeInOutBack"})}console.log(inviteCode),$("#invite_code").val(inviteCode).trigger("change"),$("#msform").on("submit",(function(e){e.preventDefault(),$("#alert-wrapper").html(alert_markup("info","<strong>Just a sec!</strong> We are saving your details.")),updateRSVP(transformForUpdate(convertFormToJSON($(this)))).then((e=>{$("#alert-wrapper").html(alert_markup("info","<strong>Success!</strong> Your RSVP status has been updated."))})).catch((e=>{$("#alert-wrapper").html(alert_markup("danger","<strong>Sorry!</strong> There is some issue with the server. ")),console.log(e)}))}));